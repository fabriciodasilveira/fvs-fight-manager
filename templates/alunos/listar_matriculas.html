{% extends "base.html" %}

{% block content %}
<a href="{{ url_for('matricular') }}" class="btn btn-primary mb-3">Nova Matricula</a>

<div class="container mt-5">
    <h1 class="mb-4">Alunos Matriculados</h1>

    <table class="table table-striped">
        <thead>
            <tr>
                <th>Aluno</th>
                <th>CPF</th>
                <th>Email</th>
                <th>Matrículas</th>
            </tr>
        </thead>
        <tbody>
            {% for aluno_info in alunos %}
            <tr>
                <td>{{ aluno_info.aluno.nome }}</td>
                <td>{{ aluno_info.aluno.cpf }}</td>
                <td>{{ aluno_info.aluno.email }}</td>
                <td>
                    <ul class="list-unstyled">
                        {% for matricula in aluno_info.matriculas %}
                        <li>
                            <strong>Plano:</strong> {{ matricula.plano_nome }}<br>
                            <strong>Status:</strong> {{ matricula.status }}<br>
                            <strong>Data de Matrícula:</strong> {{ matricula.data_matricula }}<br>
                            <form method="POST" action="{{ url_for('alterar_status_matricula', aluno_id=aluno_info.aluno.id, plano_id=matricula.plano_id) }}" style="display:inline;">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                <button type="submit" class="btn btn-sm {% if matricula.status == 'ativo' %}btn-warning{% else %}btn-success{% endif %}">
                                    {% if matricula.status == 'ativo' %}Trancar Matrícula{% else %}Retomar Plano{% endif %}
                                </button>
                            </form>
                        </li>
                        <hr>
                        {% endfor %}
                    </ul>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}